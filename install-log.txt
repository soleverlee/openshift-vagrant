yum install wget git net-tools bind-utils yum-utils iptables-services bridge-utils bash-completion kexec-tools sos psacct

yum install unzip

vagrant provision --provision-with master-key,node01-key,node02-key

yum -y install https://releases.ansible.com/ansible/rpm/release/epel-7-x86_64/ansible-2.9.6-1.el7.ans.noarch.rpm

.ssh/config

wget
curl -sSL https://github.com/openshift/openshift-ansible/archive/openshift-ansible-3.11.187-1.zip > openshift-ansible-3.11.187-1.zip
unzip openshift-ansible-3.11.187-1.zip
mv openshift-ansible-openshift-ansible-3.11.187-1/ openshift-ansible

sed -i 's/mirror.centos.org/mirrors.163.com/g' openshift-ansible/roles/openshift_repos/templates/CentOS-OpenShift-Origin311.repo.j2

/etc/ansible/hosts

ansible-playbook /home/vagrant/openshift-ansible/playbooks/prerequisites.yml

```
PLAY RECAP **************************************************************************
localhost                  : ok=11   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0
master.example.com         : ok=86   changed=21   unreachable=0    failed=0    skipped=125  rescued=0    ignored=0
node01.example.com         : ok=60   changed=21   unreachable=0    failed=0    skipped=108  rescued=0    ignored=0
node02.example.com         : ok=60   changed=21   unreachable=0    failed=0    skipped=108  rescued=0    ignored=0
```


failed: [master.example.com] (item=etcd) => {"ansible_loop_var": "item", "attempts": 72, "changed": false, "item": "etcd", "msg": {"cmd": "/bin/oc get pod master-etcd-master.example.com -o json -n kube-system", "results": [{}], "returncode": 1, "stderr": "The connection to the server master.example.com:8443 was refused - did you specify the right host or port?\n", "stdout": ""}}


127.0.0.1       master.example.com      master
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

## vagrant-hostmanager-start
192.168.11.102  node02.example.com

192.168.11.100  master.example.com

192.168.11.101  node01.example.com

## vagrant-hostmanager-end






TASK [openshift_control_plane : Report control plane errors] ********************************************************************************
fatal: [master.example.com]: FAILED! => {"changed": false, "msg": "Control plane pods didn't come up and become ready"}

NO MORE HOSTS LEFT **************************************************************************************************************************

PLAY RECAP **********************************************************************************************************************************
localhost                  : ok=11   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0
master.example.com         : ok=303  changed=51   unreachable=0    failed=1    skipped=251  rescued=0    ignored=4
node01.example.com         : ok=106  changed=15   unreachable=0    failed=0    skipped=98   rescued=0    ignored=0
node02.example.com         : ok=106  changed=15   unreachable=0    failed=0    skipped=98   rescued=0    ignored=0




fatal: [master.example.com]: FAILED! => {"all_subjects_found": ["subject=/O=system:nodes/CN=system:node:localhost.localdomain\n", "subject=/O=system:nodes/CN=system:node:localhost.localdomain\n", "subject=/O=system:nodes/CN=system:node:localhost.localdomain\n", "subject=/O=system:nodes/CN=system:node:localhost.localdomain\n"], "attempts": 30, "changed": false, "client_approve_results": [], "client_csrs": {}, "msg": "Could not find csr for nodes: node02.example.com, node01.example.com", "oc_get_nodes": {"apiVersion": "v1", "items": [{"apiVersion": "v1", "kind": "Node", "metadata": {"annotations": {"node.openshift.io/md5sum": "a4305b3db4427b8d4bd21c1a11115c5d", "volumes.kubernetes.io/controller-managed-attach-detach": "true"}, "creationTimestamp": "2020-03-10T15:15:02Z", "labels": {"beta.kubernetes.io/arch": "amd64", "beta.kubernetes.io/os": "linux", "kubernetes.io/hostname": "localhost.localdomain", "node-role.kubernetes.io/infra": "true", "node-role.kubernetes.io/master": "true"}, "name": "localhost.localdomain", "namespace": "", "resourceVersion": "1805", "selfLink": "/api/v1/nodes/localhost.localdomain", "uid": "ea45703c-62e1-11ea-997b-5254008afee6"}, "spec": {}, "status": {"addresses": [{"address": "10.0.2.15", "type": "InternalIP"}, {"address": "localhost.localdomain", "type": "Hostname"}], "allocatable": {"cpu": "2", "hugepages-2Mi": "0", "memory": "3778064Ki", "pods": "250"}, "capacity": {"cpu": "2", "hugepages-2Mi": "0", "memory": "3880464Ki", "pods": "250"}, "conditions": [{"lastHeartbeatTime": "2020-03-10T15:22:01Z", "lastTransitionTime": "2020-03-10T15:14:57Z", "message": "kubelet has sufficient disk space available", "reason": "KubeletHasSufficientDisk", "status": "False", "type": "OutOfDisk"}, {"lastHeartbeatTime": "2020-03-10T15:22:01Z", "lastTransitionTime": "2020-03-10T15:14:57Z", "message": "kubelet has sufficient memory available", "reason": "KubeletHasSufficientMemory", "status": "False", "type": "MemoryPressure"}, {"lastHeartbeatTime": "2020-03-10T15:22:01Z", "lastTransitionTime": "2020-03-10T15:14:57Z", "message": "kubelet has no disk pressure", "reason": "KubeletHasNoDiskPressure", "status": "False", "type": "DiskPressure"}, {"lastHeartbeatTime": "2020-03-10T15:22:01Z", "lastTransitionTime": "2020-03-10T15:14:57Z", "message": "kubelet has sufficient PID available", "reason": "KubeletHasSufficientPID", "status": "False", "type": "PIDPressure"}, {"lastHeartbeatTime": "2020-03-10T15:22:01Z", "lastTransitionTime": "2020-03-10T15:19:21Z", "message": "kubelet is posting ready status", "reason": "KubeletReady", "status": "True", "type": "Ready"}], "daemonEndpoints": {"kubeletEndpoint": {"Port": 10250}}, "images": [{"names": ["docker.io/openshift/origin-node@sha256:bd1fd8ea7cda786e725336de847c9d2ea9011b539d85afe9f57093d26aa6d1e7", "docker.io/openshift/origin-node:v3.11"], "sizeBytes": 1192410168}, {"names": ["docker.io/openshift/origin-control-plane@sha256:69ecdad9b7aa5c709b09da402528da061a55886c772bc32e806e1874aca1e2b3", "docker.io/openshift/origin-control-plane:v3.11"], "sizeBytes": 835261870}, {"names": ["docker.io/openshift/origin-pod@sha256:b73a3800641076827c9459a0cc256dff149bed56fc07a2ca7e2cc28686d29fd3", "docker.io/openshift/origin-pod:v3.11.0"], "sizeBytes": 265473414}, {"names": ["quay.io/coreos/etcd@sha256:ed2b69c34840f475929abd84133e17421d0608b26f9c3cbe54c7699918580a99", "quay.io/coreos/etcd:v3.2.26"], "sizeBytes": 37605387}], "nodeInfo": {"architecture": "amd64", "bootID": "998f78cd-529e-45ae-a27b-491b4fcca09b", "containerRuntimeVersion": "docker://1.13.1", "kernelVersion": "3.10.0-957.12.2.el7.x86_64", "kubeProxyVersion": "v1.11.0+d4cacc0", "kubeletVersion": "v1.11.0+d4cacc0", "machineID": "8c1946897c2343e6a238e1fe6433ce65", "operatingSystem": "linux", "osImage": "CentOS Linux 7 (Core)", "systemUUID": "8C194689-7C23-43E6-A238-E1FE6433CE65"}}}], "kind": "List", "metadata": {"resourceVersion": "", "selfLink": ""}}, "raw_failures": [], "rc": 0, "server_approve_results": [], "server_csrs": null, "state": "unknown", "unwanted_csrs": [{"apiVersion": "certificates.k8s.io/v1beta1", "kind": "CertificateSigningRequest", "metadata": {"creationTimestamp": "2020-03-10T15:19:11Z", "generateName": "csr-", "name": "csr-7xmwc", "namespace": "", "resourceVersion": "1540", "selfLink": "/apis/certificates.k8s.io/v1beta1/certificatesigningrequests/csr-7xmwc", "uid": "7e6a3c5b-62e2-11ea-997b-5254008afee6"}, "spec": {"groups": ["system:nodes", "system:authenticated"], "request": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQlREQ0I4Z0lCQURCRE1SVXdFd1lEVlFRS0V3eHplWE4wWlcwNmJtOWtaWE14S2pBb0JnTlZCQU1USVhONQpjM1JsYlRwdWIyUmxPbXh2WTJGc2FHOXpkQzVzYjJOaGJHUnZiV0ZwYmpCWk1CTUdCeXFHU000OUFnRUdDQ3FHClNNNDlBd0VIQTBJQUJFblpLMEtqNG01ZUtIamdTTm9selBGNEZTMzNaKzJwL1ZSb0FlcDBQL0lwOWVJY3ZEY1UKRjlsUnZtZ0Y4Tm1SYkNJZERaV0FDbGR1cXhGQVJlWGJXczJnVFRCTEJna3Foa2lHOXcwQkNRNHhQakE4TURvRwpBMVVkRVFRek1ER0NGV3h2WTJGc2FHOXpkQzVzYjJOaGJHUnZiV0ZwYm9JQWh3UUtBQUlQaHdUQXFBdGtod1NzCkVRQUJod1FLZ0FBQk1Bb0dDQ3FHU000OUJBTUNBMGtBTUVZQ0lRQ1NGSDNWMTh5aElycUM5L2g5c3QyRDlsdngKa2N6Z2dOSnBQQkdYVHJqV3BBSWhBT3hkeUFBYksvSW5YKzlEdnc0MUk5R2tzM2RybytIL2xuellMM3VqbWVoZQotLS0tLUVORCBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0K", "usages": ["digital signature", "key encipherment", "server auth"], "username": "system:node:localhost.localdomain"}, "status": {}}, {"apiVersion": "certificates.k8s.io/v1beta1", "kind": "CertificateSigningRequest", "metadata": {"creationTimestamp": "2020-03-10T15:18:35Z", "generateName": "csr-", "name": "csr-k9j9h", "namespace": "", "resourceVersion": "1241", "selfLink": "/apis/certificates.k8s.io/v1beta1/certificatesigningrequests/csr-k9j9h", "uid": "69018caa-62e2-11ea-997b-5254008afee6"}, "spec": {"groups": ["system:nodes", "system:authenticated"], "request": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQlJqQ0I3QUlCQURCRE1SVXdFd1lEVlFRS0V3eHplWE4wWlcwNmJtOWtaWE14S2pBb0JnTlZCQU1USVhONQpjM1JsYlRwdWIyUmxPbXh2WTJGc2FHOXpkQzVzYjJOaGJHUnZiV0ZwYmpCWk1CTUdCeXFHU000OUFnRUdDQ3FHClNNNDlBd0VIQTBJQUJCeHg2djV5Sk0xV0hCbTRpVnRMeDVnM0xUSVA2MVFJTjFZM0ZNcGN1UlM3NDlOc0lSVGEKN2tQN0FNMXNtTVV4SzZBTFc5NVk2dVBhMU56NUwrd2k3NzZnUnpCRkJna3Foa2lHOXcwQkNRNHhPREEyTURRRwpBMVVkRVFRdE1DdUNGV3h2WTJGc2FHOXpkQzVzYjJOaGJHUnZiV0ZwYm9JQWh3UUtBQUlQaHdUQXFBdGtod1NzCkVRQUJNQW9HQ0NxR1NNNDlCQU1DQTBrQU1FWUNJUURON1V0SzNZaWVhWWJoN3p1ZnNHVUxuUmxacGZYWE1KMmoKR2J5a2JTR3VDQUloQU42M0l1RTJMNXA3cW5sbXRIb0RuMlh5ckFUb01qOUJCRWVabkU2cFlSNXYKLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==", "usages": ["digital signature", "key encipherment", "server auth"], "username": "system:node:localhost.localdomain"}, "status": {}}, {"apiVersion": "certificates.k8s.io/v1beta1", "kind": "CertificateSigningRequest", "metadata": {"creationTimestamp": "2020-03-10T15:15:05Z", "generateName": "csr-", "name": "csr-sv7mg", "namespace": "", "resourceVersion": "443", "selfLink": "/apis/certificates.k8s.io/v1beta1/certificatesigningrequests/csr-sv7mg", "uid": "ebf22c41-62e1-11ea-997b-5254008afee6"}, "spec": {"groups": ["system:masters", "system:cluster-admins", "system:authenticated"], "request": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlIK01JR2xBZ0VBTUVNeEZUQVRCZ05WQkFvVERITjVjM1JsYlRwdWIyUmxjekVxTUNnR0ExVUVBeE1oYzNsegpkR1Z0T201dlpHVTZiRzlqWVd4b2IzTjBMbXh2WTJGc1pHOXRZV2x1TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJCnpqMERBUWNEUWdBRURXbjF6R1JYZk5icXBLQ2dIRzVLMStHSkxXRmcwRUcwTmIzUkJOVTUzdEcxV1FzUHlESngKd01iOHlDdzdUaVEwSHlGZUZOWFRqMi9iOVBsSC9NdWZHS0FBTUFvR0NDcUdTTTQ5QkFNQ0EwZ0FNRVVDSUIwUQpJOVFUZGtCaW9vQ011b003b1lyM0YrRGprSkoydzlhRWdOaUk4emduQWlFQXFCd2l6a3F1U01OR090b080YUZHCmpmdUZBb0xldTRrTHlmSXdKbHcwTWcwPQotLS0tLUVORCBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0K", "usages": ["digital signature", "key encipherment", "client auth"], "username": "system:admin"}, "status": {"certificate": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNnRENDQVdpZ0F3SUJBZ0lVV0h3V1NtUFdpQ2ltNUkzOUtPb1l3NFhQWE9Nd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0pqRWtNQ0lHQTFVRUF3d2JiM0JsYm5Ob2FXWjBMWE5wWjI1bGNrQXhOVGd6T0RVek1EVTBNQjRYRFRJdwpNRE14TURFMU1UQXdNRm9YRFRJeE1ETXhNREUxTVRBd01Gb3dRekVWTUJNR0ExVUVDaE1NYzNsemRHVnRPbTV2ClpHVnpNU293S0FZRFZRUURFeUZ6ZVhOMFpXMDZibTlrWlRwc2IyTmhiR2h2YzNRdWJHOWpZV3hrYjIxaGFXNHcKV1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVFOYWZYTVpGZDgxdXFrb0tBY2Jrclg0WWt0WVdEUQpRYlExdmRFRTFUbmUwYlZaQ3cvSU1uSEF4dnpJTER0T0pEUWZJVjRVMWRPUGI5djArVWY4eTU4WW8xUXdVakFPCkJnTlZIUThCQWY4RUJBTUNCYUF3RXdZRFZSMGxCQXd3Q2dZSUt3WUJCUVVIQXdJd0RBWURWUjBUQVFIL0JBSXcKQURBZEJnTlZIUTRFRmdRVXVaMjdpRGZnYVVYNitqZHdlN3Y5allGamFCRXdEUVlKS29aSWh2Y05BUUVMQlFBRApnZ0VCQUcwRDRvSzNNZFRhV3NWSzBmMFd1dWtJcXJ5eEJpVC9iV2dkRUlTeGJNMWFDVkFTa2NpcVZUUFgzdWlUCllCNjluWkNUcHF5VHIrRFFIMElJb2Z3ZFNLbkVaVE5rdysvTEZzaDlvMHJ1VlQ1Yk5RNjFJWFVReFU3a1p1ZHAKRXR4YXZVdVNUTWdpdG54R1h2aS9ERjFQdUlwWjF6NHcycGJtajdUMmEzM243TkI0U2ZSLzQyUHhBd2lZZ3J2eApBYXpZdytLOWZGekR2T2xPSUsyYVNXZFg2RU5GN1lvS0dlZEo3TElYWC9jalkwMjA3YU5sa1V2N0haM29LdnBlCndldVVveExiNEd5WkVyQTBGSExJSzlDeGx3YnBOVC8ySmd2ZTZlb0hwWjBIbHVjY1ZjRnZqMkVuZzZNMTNjZDkKTGNGNngyQjZnY3dWYkZXQWdiR20zK3lURmtZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==", "conditions": [{"lastUpdateTime": "2020-03-10T15:15:06Z", "message": "Auto approving kubelet client certificate after SubjectAccessReview.", "reason": "AutoApproved", "type": "Approved"}]}}, {"apiVersion": "certificates.k8s.io/v1beta1", "kind": "CertificateSigningRequest", "metadata": {"creationTimestamp": "2020-03-10T15:15:05Z", "generateName": "csr-", "name": "csr-wsczb", "namespace": "", "resourceVersion": "381", "selfLink": "/apis/certificates.k8s.io/v1beta1/certificatesigningrequests/csr-wsczb", "uid": "ec499efe-62e1-11ea-997b-5254008afee6"}, "spec": {"groups": ["system:masters", "system:cluster-admins", "system:authenticated"], "request": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQlJUQ0I3QUlCQURCRE1SVXdFd1lEVlFRS0V3eHplWE4wWlcwNmJtOWtaWE14S2pBb0JnTlZCQU1USVhONQpjM1JsYlRwdWIyUmxPbXh2WTJGc2FHOXpkQzVzYjJOaGJHUnZiV0ZwYmpCWk1CTUdCeXFHU000OUFnRUdDQ3FHClNNNDlBd0VIQTBJQUJPUWF5eDdFSHJPaWxlTmpXS1Jrc0ZPYmowSUFnaWhZcHhKQTd5RFdCb2p5Z3VodE91a0UKZmZ6YnlEUTFVNEtzNURSQW5nYlJKeThzVzJmb0xVTURoWnVnUnpCRkJna3Foa2lHOXcwQkNRNHhPREEyTURRRwpBMVVkRVFRdE1DdUNGV3h2WTJGc2FHOXpkQzVzYjJOaGJHUnZiV0ZwYm9JQWh3UUtBQUlQaHdUQXFBdGtod1NzCkVRQUJNQW9HQ0NxR1NNNDlCQU1DQTBnQU1FVUNJUUR5bUtWa2xFRFFtOWhsM1R4S1RGcklBNTEwbFZCSERoMkUKK3dCZjBLQ1VEUUlnRXBOY0ZKV1U2ZExQMnp1Ty9VS1U0VFYxZHRxUW5XZUFTUmZ0SkQwVjFjND0KLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==", "usages": ["digital signature", "key encipherment", "server auth"], "username": "system:admin"}, "status": {}}]}


PLAY RECAP ***********************************************************************************************************
localhost                  : ok=11   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0
master.example.com         : ok=622  changed=275  unreachable=0    failed=0    skipped=987  rescued=0    ignored=0
node01.example.com         : ok=130  changed=63   unreachable=0    failed=0    skipped=167  rescued=0    ignored=0
node02.example.com         : ok=130  changed=63   unreachable=0    failed=0    skipped=167  rescued=0    ignored=0


INSTALLER STATUS *****************************************************************************************************
Initialization               : Complete (0:00:18)
Health Check                 : Complete (0:00:04)
Node Bootstrap Preparation   : Complete (0:34:23)
etcd Install                 : Complete (0:00:32)
Master Install               : Complete (0:07:48)
Master Additional Install    : Complete (0:00:34)
Node Join                    : Complete (0:06:56)
Hosted Install               : Complete (0:00:56)
Cluster Monitoring Operator  : Complete (0:02:47)
Web Console Install          : Complete (0:01:45)
Console Install              : Complete (0:01:21)
Service Catalog Install      : Complete (0:07:53)
